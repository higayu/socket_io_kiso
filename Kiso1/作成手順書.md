# Socket.IO ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ‰‹é †æ›¸

## âœ… å‰ææ¡ä»¶

- Node.js ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨  
  ï¼ˆç¢ºèªã‚³ãƒãƒ³ãƒ‰ï¼š`node -v`ï¼‰

- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å´ã®console.logã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å‡ºåŠ›
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®console.logã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒãƒƒã‚¯ã§å‡ºåŠ›

---

## ğŸ“š Socket.ID ã«ã¤ã„ã¦

### socket.idã¨ã¯
`socket.id`ã¯ã€Socket.IOãŒå„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šã«è‡ªå‹•çš„ã«å‰²ã‚Šå½“ã¦ã‚‹**ä¸€æ„ã®è­˜åˆ¥å­**ã§ã™ã€‚

### ç‰¹å¾´
- **è‡ªå‹•ç”Ÿæˆ**: ã‚µãƒ¼ãƒãƒ¼ãŒæ¥ç¶šæ™‚ã«è‡ªå‹•çš„ã«ç”Ÿæˆ
- **ä¸€æ„æ€§**: åŒã˜ã‚µãƒ¼ãƒãƒ¼å†…ã§é‡è¤‡ã—ãªã„
- **ä¸€æ™‚çš„**: æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã‚‹ã¨ç„¡åŠ¹ã«ãªã‚‹
- **å†æ¥ç¶šæ™‚**: æ–°ã—ã„æ¥ç¶šã§ã¯æ–°ã—ã„IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹

### ä½¿ç”¨ä¾‹
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  console.log(`æ–°ã—ã„æ¥ç¶š: ${socket.id}`);
  
  // ç‰¹å®šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
  socket.emit('message', 'ã‚ãªãŸå°‚ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
  
  // ä»–ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
  socket.broadcast.emit('message', `${socket.id}ãŒæ¥ç¶šã—ã¾ã—ãŸ`);
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
const socket = io();
console.log('æ¥ç¶šID:', socket.id); // ä¾‹: "abc123def456"

socket.on('connect', () => {
  console.log('æ¥ç¶šID:', socket.id);
});
```

### å®Ÿéš›ã®å€¤ã®ä¾‹
```
æ¥ç¶šID: abc123def456
æ¥ç¶šID: xyz789uvw012
æ¥ç¶šID: mno345pqr678
```

### ç”¨é€”
1. **å€‹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡**: ç‰¹å®šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã®ã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: æ¥ç¶šä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è­˜åˆ¥
3. **ãƒ‡ãƒãƒƒã‚°**: æ¥ç¶šçŠ¶æ…‹ã®ç¢ºèª
4. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ä¸€æ™‚çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥

### æ³¨æ„ç‚¹
- ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨æ–°ã—ã„IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹ã¨IDã¯ç„¡åŠ¹ã«ãªã‚‹
- åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ç•°ãªã‚‹ã‚¿ãƒ–ã§ã¯ç•°ãªã‚‹IDã«ãªã‚‹

---

## ğŸ”„ Socket.IOã§ã®ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡æ–¹æ³•

### 1. ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
socket.emit('userCount', connectedUsers);

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('userCount', (count) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:', count);
});
```

### 2. æ¥ç¶šæ™‚ã®åˆæœŸãƒ‡ãƒ¼ã‚¿é€ä¿¡
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  // æ¥ç¶šç›´å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
  socket.emit('initialData', {
    userCount: connectedUsers,
    serverTime: new Date(),
    socketId: socket.id
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('initialData', (data) => {
  console.log('åˆæœŸãƒ‡ãƒ¼ã‚¿:', data);
});
```

### 3. ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆéæ¨å¥¨ï¼‰
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  socket.userData = {
    id: socket.id,
    connectedAt: new Date(),
    userCount: connectedUsers
  };
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆã“ã‚Œã¯å‹•ä½œã—ã¾ã›ã‚“ï¼‰
// socket.userData ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“
```

### 4. æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```javascript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.emit('getUserCount');

// ã‚µãƒ¼ãƒãƒ¼å´
socket.on('getUserCount', () => {
  socket.emit('userCount', connectedUsers);
});
```

### 5. èªè¨¼ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡
```javascript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
const socket = io({
  auth: {
    username: 'user123',
    token: 'abc123'
  }
});

// ã‚µãƒ¼ãƒãƒ¼å´
io.use((socket, next) => {
  const username = socket.handshake.auth.username;
  const token = socket.handshake.auth.token;
  
  if (token === 'abc123') {
    socket.username = username;
    next();
  } else {
    next(new Error('èªè¨¼ã‚¨ãƒ©ãƒ¼'));
  }
});
```

### 6. ãƒ«ãƒ¼ãƒ æ©Ÿèƒ½ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  socket.join('room1');
  
  // ãƒ«ãƒ¼ãƒ å†…ã®å…¨å“¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
  io.to('room1').emit('roomData', {
    roomName: 'room1',
    memberCount: io.sockets.adapter.rooms.get('room1').size
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('roomData', (data) => {
  console.log('ãƒ«ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', data);
});
```

### ãªãœã‚¤ãƒ™ãƒ³ãƒˆãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã‹

1. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§**: ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã‚’å³åº§ã«é€šçŸ¥
2. **åŒæ–¹å‘é€šä¿¡**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ‡”ã‚µãƒ¼ãƒãƒ¼é–“ã®åŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿äº¤æ›
3. **å‹å®‰å…¨æ€§**: ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’æ˜ç¢ºã«å®šç¾©
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: é€ä¿¡å¤±æ•—æ™‚ã®å‡¦ç†ãŒå¯èƒ½
5. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ä¸€æ‹¬é€ä¿¡ãŒå®¹æ˜“

### å®Ÿéš›ã®ä½¿ç”¨ä¾‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆï¼‰

```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  connectedUsers++;
  
  // æ–¹æ³•1: æ¥ç¶šæ™‚ã«é€ä¿¡
  socket.emit('userCount', connectedUsers);
  
  // æ–¹æ³•2: å…¨å“¡ã«é€šçŸ¥
  io.emit('userCount', connectedUsers);
  
  // æ–¹æ³•3: æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾å¿œ
  socket.on('requestUserCount', () => {
    socket.emit('userCount', connectedUsers);
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('userCount', (count) => {
  document.getElementById('userCount').textContent = `ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${count}äºº`;
});

// æ‰‹å‹•ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—
socket.emit('requestUserCount');
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

### åŸºæœ¬æ©Ÿèƒ½
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- **æ¥ç¶šçŠ¶æ…‹è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®æ¥ç¶šçŠ¶æ…‹ç¢ºèª
- **æ¥ç¶šæ•°ç®¡ç†**: ã‚µãƒ¼ãƒãƒ¼å´ã§ã®æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ç®¡ç†

### ãƒšãƒ¼ã‚¸é·ç§»ãƒ†ã‚¹ãƒˆ
- **ãƒšãƒ¼ã‚¸é–“ç§»å‹•**: 3ã¤ã®ãƒšãƒ¼ã‚¸é–“ã§ã®ç§»å‹•ãƒ†ã‚¹ãƒˆ
- **æ¥ç¶šç¶­æŒ**: ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®Socket.IOæ¥ç¶šçŠ¶æ…‹ç¢ºèª
- **è¤‡æ•°ã‚¿ãƒ–**: æ–°ã—ã„ã‚¿ãƒ–ã§ã®å‹•ä½œç¢ºèª
- **æ‰‹å‹•ãƒ†ã‚¹ãƒˆ**: æ¥ç¶šãƒ»åˆ‡æ–­ãƒ»å†æ¥ç¶šã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆæ‰‹é †
1. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
2. ãƒšãƒ¼ã‚¸2ã«ç§»å‹•ã—ã¦æ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèª
3. ãƒšãƒ¼ã‚¸3ã§ãƒšãƒ¼ã‚¸é·ç§»å±¥æ­´ã‚’ç¢ºèª
4. æ–°ã—ã„ã‚¿ãƒ–ã§ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦è¤‡æ•°æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
5. æ‰‹å‹•ã§åˆ‡æ–­ãƒ»å†æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ

---

## ğŸ“ ä¸»ãªæ©Ÿèƒ½

- âœ… Socket.IOæ¥ç¶šç®¡ç†
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- âœ… ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®æ¥ç¶šç¶­æŒ
- âœ… æ¥ç¶šçŠ¶æ…‹ã®å¯è¦–åŒ–
- âœ… è¤‡æ•°ãƒšãƒ¼ã‚¸ã§ã®å‹•ä½œç¢ºèª
- âœ… æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

---

## ğŸ”„ ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ vs æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å‹ï¼‰

**ç‰¹å¾´**: ã‚µãƒ¼ãƒãƒ¼ãŒè‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡

```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  connectedUsers++;
  
  // æ¥ç¶šæ™‚ã«è‡ªå‹•é€ä¿¡
  socket.emit('userCount', connectedUsers);
  
  // å…¨å“¡ã«è‡ªå‹•é€šçŸ¥
  io.emit('userCount', connectedUsers);
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('userCount', (count) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:', count);
});
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé«˜ã„
- âœ… ã‚µãƒ¼ãƒãƒ¼ä¸»å°ã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°
- âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«
- âœ… è‡ªå‹•çš„ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âŒ ä¸è¦ãªãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®å¯èƒ½æ€§
- âŒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã§ããªã„

### æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒ—ãƒ«å‹ï¼‰

**ç‰¹å¾´**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¦æ±‚ã—ãŸæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡

```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¾…ã¡å—ã‘
  socket.on('getUserCount', () => {
    socket.emit('userCount', connectedUsers);
  });
  
  socket.on('getServerTime', () => {
    socket.emit('serverTime', new Date());
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
// å¿…è¦ãªæ™‚ã«æ‰‹å‹•ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
socket.emit('getUserCount');

socket.on('userCount', (count) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:', count);
});
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… å¿…è¦ãªæ™‚ã ã‘ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å–å¾—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è² è·ã‚’è»½æ¸›
- âœ… ç´°ã‹ã„åˆ¶å¾¡ãŒå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âŒ å®Ÿè£…ãŒè¤‡é›‘ã«ãªã‚‹
- âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒä½ã„
- âŒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å®šæœŸçš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¿…è¦

---

### å®Ÿéš›ã®ä½¿ç”¨ä¾‹æ¯”è¼ƒ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½

**ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰**:
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  connectedUsers++;
  io.emit('userCount', connectedUsers); // è‡ªå‹•é€ä¿¡
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('userCount', (count) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:', count);
});
```

**æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  socket.on('requestUserCount', () => {
    socket.emit('userCount', connectedUsers);
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
function updateUserCount() {
  socket.emit('requestUserCount'); // æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
}

socket.on('userCount', (count) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:', count);
});

// å®šæœŸçš„ã«æ›´æ–°
setInterval(updateUserCount, 5000);
```

#### ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½

**ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹**:
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
socket.on('clientMessage', (data) => {
  io.emit('message', `ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.message}`); // è‡ªå‹•é…ä¿¡
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('message', (message) => {
  displayMessage(message); // è‡ªå‹•å—ä¿¡
});
```

**æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
socket.on('sendMessage', (data) => {
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
  messages.push(data);
  socket.emit('messageSent', { success: true });
});

socket.on('getMessages', () => {
  socket.emit('messages', messages); // ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿é€ä¿¡
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
function sendMessage(message) {
  socket.emit('sendMessage', { message });
}

function getMessages() {
  socket.emit('getMessages'); // æ‰‹å‹•ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—
}

socket.on('messages', (messages) => {
  displayMessages(messages);
});
```

---

### ä½¿ã„åˆ†ã‘ã®åŸºæº–

#### ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†å ´åˆ
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé‡è¦ãªå ´åˆ
- âœ… ãƒ‡ãƒ¼ã‚¿ãŒé »ç¹ã«å¤‰æ›´ã•ã‚Œã‚‹å ´åˆ
- âœ… å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŒæ™‚é€šçŸ¥ãŒå¿…è¦ãªå ´åˆ
- âœ… ãƒãƒ£ãƒƒãƒˆã€é€šçŸ¥ã€ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãªã©

#### æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½¿ã†å ´åˆ
- âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã—ãŸã„å ´åˆ
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è² è·ã‚’è»½æ¸›ã—ãŸã„å ´åˆ
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å ´åˆ
- âœ… è¨­å®šæƒ…å ±ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€å±¥æ­´ãªã©

#### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
```javascript
// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° + æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
io.on('connection', (socket) => {
  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ï¼‰
  socket.on('clientMessage', (data) => {
    io.emit('message', `ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.message}`);
  });
  
  // æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆæ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
  socket.on('refreshMessages', () => {
    socket.emit('allMessages', messages);
  });
});
```

---

### å®Ÿéš›ã®ä½¿ç”¨ä¾‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆï¼‰

```javascript
// ã‚µãƒ¼ãƒãƒ¼å´
io.on('connection', (socket) => {
  connectedUsers++;
  
  // æ–¹æ³•1: æ¥ç¶šæ™‚ã«é€ä¿¡
  socket.emit('userCount', connectedUsers);
  
  // æ–¹æ³•2: å…¨å“¡ã«é€šçŸ¥
  io.emit('userCount', connectedUsers);
  
  // æ–¹æ³•3: æ‰‹å‹•ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾å¿œ
  socket.on('requestUserCount', () => {
    socket.emit('userCount', connectedUsers);
  });
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
socket.on('userCount', (count) => {
  document.getElementById('userCount').textContent = `ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${count}äºº`;
});

// æ‰‹å‹•ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—
socket.emit('requestUserCount');
```

---

## â‘  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ

```bash
mkdir Kiso1
cd Kiso1
```

## â‘¡ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–

```bash
npm init -y
npm install express socket.io
```

## â‘¢ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
Kiso1/
â”œâ”€â”€ node_modules/          # npmã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”œâ”€â”€ package.json           # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package-lock.json      # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šç”¨ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ server.js              # ã‚µãƒ¼ãƒãƒ¼å´ã®Socket.IOå®Ÿè£…
â”œâ”€â”€ public/                # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ index.html         # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ï¼‰
â”‚   â”œâ”€â”€ page2.html         # ãƒšãƒ¼ã‚¸2ï¼ˆæ¥ç¶šçŠ¶æ…‹ãƒ†ã‚¹ãƒˆï¼‰
â”‚   â””â”€â”€ page3.html         # ãƒšãƒ¼ã‚¸3ï¼ˆãƒšãƒ¼ã‚¸é·ç§»ãƒ†ã‚¹ãƒˆï¼‰
â””â”€â”€ ä½œæˆæ‰‹é †æ›¸.md          # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## â‘£ ã‚µãƒ¼ãƒãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆï¼ˆserver.jsï¼‰

```javascript
// server.js
const express = require('express');
const http = require('http');
const { Server } = require('socket.io');

const app = express();
const server = http.createServer(app);
const io = new Server(server);

// æ¥ç¶šä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’ç®¡ç†
let connectedUsers = 0;

// Socket.IOæ¥ç¶šå‡¦ç†
io.on('connection', (socket) => {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å¢—ã‚„ã™
  connectedUsers++;
  console.log(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¥ç¶šã—ã¾ã—ãŸã€‚ç¾åœ¨ã®æ¥ç¶šæ•°: ${connectedUsers}`);
  
  // æ¥ç¶šæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
  socket.emit('message', 'ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã—ãŸï¼');
  
  // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ–°ã—ã„æ¥ç¶šã‚’é€šçŸ¥
  socket.broadcast.emit('message', 'æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¥ç¶šã—ã¾ã—ãŸ');
  
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
  socket.on('clientMessage', (data) => {
    console.log(`å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${data.message}`);
    
    // å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
    io.emit('message', `ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.message}`);
  });
  
  // åˆ‡æ–­æ™‚ã®å‡¦ç†
  socket.on('disconnect', () => {
    connectedUsers--;
    console.log(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ‡æ–­ã—ã¾ã—ãŸã€‚ç¾åœ¨ã®æ¥ç¶šæ•°: ${connectedUsers}`);
    socket.broadcast.emit('message', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ‡æ–­ã—ã¾ã—ãŸ');
  });
});

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®æä¾›
app.get('/', (req, res) => {
  res.sendFile(__dirname + '/public/index.html');
});

app.get('/page2', (req, res) => {
  res.sendFile(__dirname + '/public/page2.html');
});

app.get('/page3', (req, res) => {
  res.sendFile(__dirname + '/public/page3.html');
});

// ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
const PORT = 3000;
server.listen(PORT, () => {
  console.log(`ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¾ã—ãŸ: http://localhost:${PORT}`);
});
```

## â‘¤ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆHTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

### ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆpublic/index.htmlï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO ã‚µãƒ³ãƒ—ãƒ«</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        #messages {
            height: 300px;
            border: 1px solid #ccc;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        #messageInput {
            width: 70%;
            padding: 5px;
        }
        #sendButton {
            width: 25%;
            padding: 5px;
            margin-left: 5px;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .server-message {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .user-message {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        .nav-links {
            margin: 20px 0;
        }
        .nav-links a {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .nav-links a:hover {
            background-color: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <h1>Socket.IO ã‚µãƒ³ãƒ—ãƒ«</h1>
    
    <div class="nav-links">
        <a href="/">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>
        <a href="/page2">ãƒšãƒ¼ã‚¸2</a>
        <a href="/page3">ãƒšãƒ¼ã‚¸3</a>
    </div>

    <div class="status">
        æ¥ç¶šçŠ¶æ…‹: æ¥ç¶šä¸­...
    </div>

    <div id="messages"></div>
    <div>
        <input type="text" id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        <button id="sendButton">é€ä¿¡</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const statusDiv = document.querySelector('.status');

        // æ¥ç¶šæˆåŠŸæ™‚
        socket.on('connect', () => {
            statusDiv.textContent = `æ¥ç¶šçŠ¶æ…‹: æ¥ç¶šæ¸ˆã¿ (ID: ${socket.id})`;
            statusDiv.style.backgroundColor = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
        });

        // åˆ‡æ–­æ™‚
        socket.on('disconnect', () => {
            statusDiv.textContent = 'æ¥ç¶šçŠ¶æ…‹: åˆ‡æ–­';
            statusDiv.style.backgroundColor = '#f8d7da';
            statusDiv.style.color = '#721c24';
            statusDiv.style.border = '1px solid #f5c6cb';
        });

        // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
        socket.on('message', (message) => {
            const messageElement = document.createElement('div');
            messageElement.className = 'message server-message';
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ©Ÿèƒ½
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                socket.emit('clientMessage', { message: message });
                messageInput.value = '';
            }
        }

        // é€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚
        sendButton.addEventListener('click', sendMessage);

        // Enterã‚­ãƒ¼æŠ¼ä¸‹æ™‚
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        console.log('Socket.IOã«æ¥ç¶šã—ã¾ã—ãŸ');
    </script>
</body>
</html>
```

### ãƒšãƒ¼ã‚¸2ï¼ˆpublic/page2.htmlï¼‰

è©³ç´°ãªæ¥ç¶šçŠ¶æ…‹è¡¨ç¤ºã¨ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã‚’å«ã‚€ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚

### ãƒšãƒ¼ã‚¸3ï¼ˆpublic/page3.htmlï¼‰

ãƒšãƒ¼ã‚¸é·ç§»å±¥æ­´ã¨é«˜åº¦ãªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã‚’å«ã‚€ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚

## â‘¥ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
node server.js
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

### åŸºæœ¬æ©Ÿèƒ½
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- **æ¥ç¶šçŠ¶æ…‹è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®æ¥ç¶šçŠ¶æ…‹ç¢ºèª
- **æ¥ç¶šæ•°ç®¡ç†**: ã‚µãƒ¼ãƒãƒ¼å´ã§ã®æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ç®¡ç†

### ãƒšãƒ¼ã‚¸é·ç§»ãƒ†ã‚¹ãƒˆ
- **ãƒšãƒ¼ã‚¸é–“ç§»å‹•**: 3ã¤ã®ãƒšãƒ¼ã‚¸é–“ã§ã®ç§»å‹•ãƒ†ã‚¹ãƒˆ
- **æ¥ç¶šç¶­æŒ**: ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®Socket.IOæ¥ç¶šçŠ¶æ…‹ç¢ºèª
- **è¤‡æ•°ã‚¿ãƒ–**: æ–°ã—ã„ã‚¿ãƒ–ã§ã®å‹•ä½œç¢ºèª
- **æ‰‹å‹•ãƒ†ã‚¹ãƒˆ**: æ¥ç¶šãƒ»åˆ‡æ–­ãƒ»å†æ¥ç¶šã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆæ‰‹é †
1. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
2. ãƒšãƒ¼ã‚¸2ã«ç§»å‹•ã—ã¦æ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèª
3. ãƒšãƒ¼ã‚¸3ã§ãƒšãƒ¼ã‚¸é·ç§»å±¥æ­´ã‚’ç¢ºèª
4. æ–°ã—ã„ã‚¿ãƒ–ã§ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦è¤‡æ•°æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
5. æ‰‹å‹•ã§åˆ‡æ–­ãƒ»å†æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ

---

## ğŸ“ ä¸»ãªæ©Ÿèƒ½

- âœ… Socket.IOæ¥ç¶šç®¡ç†
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡
- âœ… ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®æ¥ç¶šç¶­æŒ
- âœ… æ¥ç¶šçŠ¶æ…‹ã®å¯è¦–åŒ–
- âœ… è¤‡æ•°ãƒšãƒ¼ã‚¸ã§ã®å‹•ä½œç¢ºèª
- âœ… æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

